<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.my.gn.manage.api.dao.ApiMapper">

	<select id="selectList" resultType="com.my.gn.manage.api.vo.ApiVO">
		SELECT INCOM_SEQ
				 , DATE_FORMAT(INCOM_YMD,'%Y-%m-%d')  AS INCOM_YMD
				 , INCOM_AMOUNT
				 , INCOM_TITLE
				 , INCOM_CONTENT
				 , INCOM_CD
				 , CRE_USER_ID
				 , CRE_DATE
				 , MOD_USER_ID
				 , MOD_DATE
				 , DEL_YN
				 , SPEND_CD
				 , (SELECT DETAIL_CD_NM FROM T_CODE WHERE GRP_CD ='SKMA' AND DETAIL_CD = A.SPEND_CD) AS SPEND_NM
		  FROM T_SPENDING A
		WHERE DEL_YN = 'N'
		    AND DATE_FORMAT(INCOM_YMD,'%Y-%m') = #{incom_ymd}
		 ORDER BY INCOM_YMD DESC, INCOM_SEQ DESC
	</select>

	<insert id="write" parameterType="com.my.gn.manage.api.vo.ApiVO">
		INSERT INTO T_SPENDING(
			 INCOM_YMD
			, INCOM_AMOUNT
			, INCOM_TITLE
			, INCOM_CONTENT
			, CRE_USER_ID
			, SPEND_CD
		)VALUES(
			 #{incom_ymd}
			, #{incom_amount}
			, #{incom_title}
			, #{incom_content}
			, #{cre_user_id}
			, #{spend_cd}
		)
	</insert> 
	
	<!-- 수정 -->
	<update id="updateSpend" parameterType="com.my.gn.manage.api.vo.ApiVO">
		UPDATE T_SPENDING
			 SET INCOM_YMD = #{incom_ymd}
			 	 , INCOM_AMOUNT = #{incom_amount}
				 , INCOM_TITLE = #{incom_title}
				 , INCOM_CONTENT = #{incom_content}
				 <if test='incom_cd != null and incom_cd !="" '>
				 , INCOM_CD = #{incom_cd}
				 </if>
				 , SPEND_CD = #{spend_cd}
		 WHERE INCOM_SEQ = #{incom_seq}
	</update>
	
	<!-- 삭제 -->
	<update id="deleteSpend" parameterType="com.my.gn.manage.api.vo.ApiVO">
		UPDATE T_SPENDING
		   	 SET DEL_YN = 'Y'
		 WHERE INCOM_SEQ = #{incom_seq}
	 </update>
	
	
</mapper>